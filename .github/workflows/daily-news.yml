name: Daily News Workflow

on:
  schedule:
    - cron: '0 1 * * *'  # æ¯å¤©UTC 1:00 (åŒ—äº¬æ—¶é—´9:00)
  workflow_dispatch:

jobs:
  trigger:
    runs-on: ubuntu-latest
    steps:
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'

    - name: Install Coze SDK
      run: |
        npm install @coze/api

    - name: Trigger Coze Workflow
      env:
        COZE_TOKEN: ${{ secrets.COZE_TOKEN }}
      run: |
        node -e "
        const { CozeAPI } = require('@coze/api');

        async function triggerWorkflow() {
          try {
            console.log('å¼€å§‹è§¦å‘å·¥ä½œæµ...');
            
            const apiClient = new CozeAPI({
              token: process.env.COZE_TOKEN,
              baseURL: 'https://api.coze.cn'
            });

            const res = await apiClient.workflows.runs.stream({
              workflow_id: '7562209382487113774',
              parameters: {
                input: 'https://auto.163.com/'
              }
            });

            console.log('âœ… å·¥ä½œæµè§¦å‘æˆåŠŸï¼');
            console.log('å“åº”:', JSON.stringify(res, null, 2));
            
          } catch (error) {
            console.error('âŒ å·¥ä½œæµè§¦å‘å¤±è´¥:');
            console.error('é”™è¯¯ä¿¡æ¯:', error.message);
            if (error.response) {
              console.error('çŠ¶æ€ç :', error.response.status);
              console.error('å“åº”æ•°æ®:', error.response.data);
            }
            process.exit(1);
          }
        }

        triggerWorkflow();
        "

    - name: Success Notification
      if: success()
      run: |
        echo "ğŸ‰ æ¯æ—¥èµ„è®¯å·¥ä½œæµæ‰§è¡ŒæˆåŠŸï¼"
        echo "æ‰§è¡Œæ—¶é—´: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
        echo "åŒ—äº¬æ—¶é—´: $(date -d '+8 hours' '+%Y-%m-%d %H:%M:%S')"
        echo "å·²è§¦å‘å·¥ä½œæµ ID: 7562209382487113774"
        echo "è¾“å…¥å‚æ•°: https://auto.163.com/"

    - name: Failure Notification
      if: failure()
      run: |
        echo "âŒ å·¥ä½œæµæ‰§è¡Œå¤±è´¥"
        echo "å¤±è´¥æ—¶é—´: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
        echo "è¯·æ£€æŸ¥:"
        echo "1. Tokenæƒé™è®¾ç½®"
        echo "2. å·¥ä½œæµIDæ˜¯å¦æ­£ç¡®"
        echo "3. ç½‘ç»œè¿æ¥"
