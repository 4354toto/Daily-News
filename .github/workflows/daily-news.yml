name: Daily News Workflow

on:
  schedule:
    - cron: '0 1 * * *'  # æ¯å¤©UTC 1:00 (åŒ—äº¬æ—¶é—´9:00)
  workflow_dispatch:

jobs:
  trigger-coze:
    runs-on: ubuntu-latest
    steps:
    - name: Check Token and Config
      run: |
        echo "Token preview: ...${COZE_TOKEN: -8}"
        echo "Workflow ID: 7565827159563550756"
        echo "API Endpoint: https://api.coze.cn/v1/workflow/stream_run"

    - name: Trigger Coze Workflow
      run: |
        # ä½¿ç”¨ç®€å•çš„curlå‘½ä»¤
        response=$(curl -s -o response_body.txt -w "%{http_code}" \
          -X POST "https://api.coze.cn/v1/workflow/stream_run" \
          -H "Authorization: Bearer ${{ secrets.COZE_TOKEN }}" \
          -H "Content-Type: application/json" \
          -d '{"workflow_id": "7565827159563550756", "parameters": {}}')
        
        echo "HTTP Status Code: $response"
        
        if [ -f "response_body.txt" ]; then
          echo "Response Body:"
          cat response_body.txt
          rm response_body.txt
        fi
        
        if [ "$response" -eq 200 ]; then
          echo "âœ… å·¥ä½œæµè§¦å‘æˆåŠŸ"
          exit 0
        else
          echo "âŒ å·¥ä½œæµè§¦å‘å¤±è´¥ï¼ŒçŠ¶æ€ç : $response"
          exit 1
        fi

    - name: Notify Success
      if: success()
      run: |
        echo "ğŸ‰ æ¯æ—¥èµ„è®¯å·¥ä½œæµæ‰§è¡ŒæˆåŠŸï¼"
        echo "æ‰§è¡Œæ—¶é—´: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"

    - name: Notify Failure
      if: failure()
      run: |
        echo "âŒ æ¯æ—¥èµ„è®¯å·¥ä½œæµæ‰§è¡Œå¤±è´¥"
        echo "å¤±è´¥æ—¶é—´: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
        echo "è¯·æ£€æŸ¥ Token æƒé™å’Œå·¥ä½œæµé…ç½®"
